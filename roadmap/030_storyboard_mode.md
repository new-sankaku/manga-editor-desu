# 030: ネーム（ストーリーボード）モード

## 規模: L (大)

## 概要
マンガの「ネーム」（ストーリーボード）段階を支援する専用モード。全ページのサムネイル一覧、ページ間の流れの確認、ラフスケッチでの構成検討を可能にする。

## 現状の問題
- ページ単位の編集のみで、作品全体の流れを俯瞰できない
- ボトムバーのサムネイルは小さく、構成の検討には不十分
- ネーム段階（ラフな構成検討）と清書段階の区別がない
- ページの入れ替え・追加・削除がボトムバーからのみで操作しづらい

## 修正内容
### ストーリーボードビュー
- 全ページのサムネイルをグリッド表示（3〜6列、拡縮可能）
- 見開き表示モード（2ページ並列）
- ページのドラッグ&ドロップによる並べ替え
- ページ間への新規ページ挿入
- ページの複製・削除

### ページメモ
- 各ページにメモ欄（シーン説明、セリフ案、演出メモ）
- メモの一覧表示（プロット管理として活用）

### ネーム専用ツール
- ラフ描画用の太ペン（低解像度・高速描画）
- 簡易キャラシルエット（丸＋棒人間テンプレート）
- 簡易吹き出し（テキストだけ入力、見た目は後で調整）
- コマ割りの仮配置（ドラッグで簡単に分割）

### ワークフロー
- ネームモード ↔ 清書モードの切り替え
- ネームモードで作った構成をそのまま清書モードに引き継ぎ
- ネームのエクスポート（低解像度PDF）

## UI設計

### 操作フロー
```
1. ボトムバーを開く（Ctrl+B）
2. ボトムバー左端の [ストーリーボード] ボタンをクリック（または Ctrl+Shift+B）
3. キャンバス領域がグリッドビューに切り替わる
4. サムネイルダブルクリックで該当ページの編集画面に戻る
```

### ビュー切り替え
`#canvas-area`内の`#intro_content`（キャンバス本体）を非表示にし、`#storyboard-view`を表示。キャンバスは破棄せず保持する。

### ストーリーボードビュー
```
+------------------------------------------------------------------+
| nav (そのまま)                                                    |
+------------------------------------------------------------------+
|                                                                    |
|  [ストーリーボード]  [× 閉じる]  列数: [3▼] [見開き表示]        |
|  ─────────────────────────────────────────────────────            |
|                                                                    |
|  ┌─────────┐  ┌─────────┐  ┌─────────┐                          |
|  │  P.1    │  │  P.2    │  │  P.3    │                          |
|  │         │  │         │  │         │                          |
|  │ (thumb) │  │ (thumb) │  │ (thumb) │                          |
|  │         │  │         │  │         │                          |
|  ├─────────┤  ├─────────┤  ├─────────┤                          |
|  │メモ:    │  │メモ:    │  │メモ:    │                          |
|  │主人公登 │  │街の風景 │  │出会い   │                          |
|  │場シーン │  │を見渡す │  │のシーン │                          |
|  └─────────┘  └─────────┘  └─────────┘                          |
|                                                                    |
|  ┌─────────┐  ┌─────────┐  ┌──── + ────┐                       |
|  │  P.4    │  │  P.5    │  │           │                        |
|  │         │  │         │  │  + 新規   │                        |
|  │ (thumb) │  │ (thumb) │  │  ページ   │                        |
|  │         │  │         │  │           │                        |
|  ├─────────┤  ├─────────┤  │           │                        |
|  │メモ:    │  │メモ:    │  │           │                        |
|  │バトル   │  │決着     │  │           │                        |
|  │開始     │  │         │  │           │                        |
|  └─────────┘  └─────────┘  └───────────┘                       |
|                                                                    |
+------------------------------------------------------------------+
| btm-drawer (ストーリーボード中は非表示)                            |
+------------------------------------------------------------------+
```

### 見開き表示モード
```
  ┌──────────────────────┐
  │  P.2    │    P.3     │  ← 偶数・奇数ページを並べて表示
  │         │            │
  │ (thumb) │  (thumb)   │
  │         │            │
  ├─────────┴────────────┤
  │メモ: 見開きバトルシーン│
  └──────────────────────┘
```

### サムネイル操作
```
ダブルクリック → そのページの編集画面に戻る
ドラッグ       → ページ順序入れ替え
メモ欄クリック → インライン編集
右クリック     → 複製 / 削除 / ページサイズ変更
「+ 新規ページ」カード → 既存のbtmShowAddPageDialog()を呼び出す
```

### データソース
- サムネイルは既存の`btmProjectsMap`から`imageLink`を取得（ボトムバーと同じデータ）
- ページメモは各ページオブジェクトに`memo`プロパティを追加、IndexedDBで永続化

## 該当箇所
- 新規: `js/ui/storyboard/`
  - `storyboard-view.js` - グリッドビュー
  - `storyboard-memo.js` - ページメモ管理
  - `storyboard-tools.js` - ネーム用簡易ツール
- 修正: `js/ui/bottom-bar.js` - ストーリーボードボタン追加
- 修正: `index.html` - `#canvas-area`内に`#storyboard-view`要素追加
- 修正: ページ管理関連

## 影響範囲
- `#canvas-area`内のビュー切り替え機構の追加
- ページ管理の大幅拡張
- ボトムバーにボタン追加

## 売りポイント
- プロのマンガ家のワークフロー（ネーム→清書）を完全にデジタル化
- 作品全体の流れを俯瞰しながら構成を練れる
- 「まずネームを描いて→AIで清書画像を生成」という新しいワークフロー
- Web漫画プラットフォームのエディタにも通じる本格的な制作環境
