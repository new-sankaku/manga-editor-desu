# 027: キャラクタープロンプト管理

## 規模: M (中)

## 概要
キャラクターごとのプロンプトテンプレート、参照画像、LoRA設定を管理し、AI生成時にワンクリックでプロンプトに挿入できる機能。マンガ全体でキャラクターの見た目を一貫させる。

## 現状の問題
- 同じキャラクターを複数コマで生成する際、毎回プロンプトを手入力
- キャラクターの外見設定（髪色、服装、特徴）をどこにも保存できない
- コマごとにプロンプトが微妙に違い、キャラの見た目がブレる
- LoRAの指定を毎回手動で行う必要がある

## 修正内容
### キャラクター登録
- キャラクター名、サムネイル画像
- 外見プロンプト（常に挿入される基本プロンプト）
  - 例: `1girl, long black hair, red eyes, school uniform`
- 表情バリエーション（オプション選択式）
  - 例: `smile`, `angry`, `crying`, `surprised`
- LoRA設定（モデル名、トリガーワード、ウェイト）
- 参照画像（複数枚登録可能）

### プロンプト挿入
- AI生成パネルにキャラクター選択ドロップダウンを追加
- 選択したキャラクターのプロンプトを自動挿入
- 複数キャラクター対応（`2girls`等に自動変換）

### 永続化
- IndexedDBに保存
- キャラクターデータのインポート/エクスポート（JSON形式）

## 該当箇所
- 新規: `js/ai/character/`
  - `character-manager.js` - キャラクター管理
  - `character-panel.js` - UI
- 新規: `js/db/character-repository.js` - IndexedDB永続化
- 修正: `js/ai/prompt/` - プロンプト生成にキャラクター情報を統合

## 影響範囲
- AI生成のプロンプト入力フロー
- サイドバーUI追加

## 売りポイント
- マンガ制作で最も重要な「キャラクターの一貫性」問題を解決
- AI生成マンガの最大の弱点（コマごとにキャラが変わる）への直接的な対策
- プロンプト入力の手間を大幅に削減
- LoRA管理まで含めた包括的なキャラ管理は他ツールにない差別化要素
