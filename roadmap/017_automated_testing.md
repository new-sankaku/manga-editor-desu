# 017: 自動テストの導入

## 規模: L (大)

## 概要
約47,000行のコードベースに自動テストが存在しない。
ユニットテストとE2Eテストを段階的に導入し、リグレッションを防止する。

## 該当箇所
- 新規作成: `tests/`ディレクトリ
- `package.json`（テスト依存関係の追加）

## 現状の問題
- 自動テストが一切ない（`test/`フォルダは実験用HTML）
- `debug.js`にTestRunnerがあるが、自動テストスイートとしては使われていない
- リファクタリングや機能追加時のデグレ検出ができない
- 手動テストに依存しており確認漏れが発生しやすい

## 修正内容
### Phase 1: テスト基盤の構築
- テストフレームワークの導入（Vitest推奨 - Viteとの親和性が高い）
- テスト実行スクリプトの`package.json`追加
- CI/CD（GitHub Actions）でのテスト自動実行

### Phase 2: ユニットテスト（優先度順）
1. **ユーティリティ関数**: 純粋関数が多く、テストしやすい
   - 圧縮/展開（LZ4）
   - 画像変換ユーティリティ
   - GUID生成/管理
2. **データ変換**: プロジェクトの保存/読み込みデータ変換
3. **レイヤー管理**: GUID連携、親子関係の構築/解除
4. **AI連携**: APIリクエスト/レスポンスの変換（モック使用）

### Phase 3: E2Eテスト
- Playwright導入
- 基本操作シナリオ:
  - キャンバス作成 → パネル配置 → 画像追加 → 保存 → 読み込み
  - テキスト追加 → スタイル変更 → 削除
  - Undo/Redoの動作検証

## 前提条件
- 015（ビルドパイプライン）があるとテスト環境構築が容易になる
- ただしPhase 2のユーティリティテストはビルドツールなしでも開始可能

## 影響範囲
- 開発ワークフロー
- CI/CDパイプライン
