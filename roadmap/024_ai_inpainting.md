# 024: AIインペインティング（部分再生成）

## 規模: M (中)

## 概要
画像の選択した領域のみをAIで再生成するインペインティング機能。手や顔の修正、背景の一部変更など、画像全体を再生成せずに部分的な修正を可能にする。

## 現状の問題
- Image2Imageは画像全体を再生成するため、修正不要な部分も変わってしまう
- 手の描画ミスや顔の微修正のためだけに全体を再生成するのは非効率
- ComfyUIにはInpaintingの仕組みがあるが、このエディタからは利用できない

## 修正内容
### マスク描画
- ブラシでマスク領域をペイント（赤半透明オーバーレイ）
- マスクブラシサイズの調整
- マスク消しゴム
- マスク反転

### ComfyUIワークフロー連携
- インペインティング用ワークフローテンプレートの追加
  - 元画像 + マスク画像 + プロンプトをComfyUIに送信
  - `%inpaint_image%`, `%inpaint_mask%` プレースホルダーの追加
- デノイズ強度の調整（元画像をどの程度残すか）

### 結果反映
- 生成結果を元画像のマスク領域にのみ合成
- Before/After比較表示

## 該当箇所
- 新規: `js/ai/inpainting/`
  - `inpaint-mask.js` - マスク描画
  - `inpaint-workflow.js` - ワークフロー連携
- 新規: `js/ai/comfyui/v2/comfyui_workflow/inpaint/` - ワークフローJSON
- 修正: `js/ui/canvas-object-menu.js` - コンテキストメニューに「Inpaint」追加

## 影響範囲
- AI生成パイプラインの拡張
- キャンバスオブジェクトメニューの追加

## 売りポイント
- AI画像生成の最大の弱点（手、顔、細部）をピンポイントで修正可能
- 「AIで生成→気になる部分だけ修正」というワークフローが完結する
- ComfyUIのInpainting機能を直感的なUIで使える唯一のマンガエディタ
